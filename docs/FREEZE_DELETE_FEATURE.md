# 凭证冻结删除功能说明

## 功能概述

为了保护用户凭证不被恶意删除，同时提供灵活的删除机制，我们实现了"冻结-解冻-自动删除"流程。

## 删除流程

### 1. 发起删除请求

当用户点击"删除"按钮时：

1. **邮箱确认**：系统会询问"这是你的邮箱吗？"
   - 点击"确定"：表示是账号所有者
   - 点击"取消"：表示不是账号所有者

2. **删除理由**（仅非所有者需要）：
   - 如果选择"不是"，需要输入删除理由
   - 理由不能少于10个字
   - 可以取消输入

3. **最终确认**：
   - 显示冻结期说明
   - 确认后进入24小时冻结期

### 2. 冻结期（24小时）

凭证进入冻结状态后：

- ❄️ 显示"冻结中"标识和剩余时间
- 🔒 禁用所有操作（启用/禁用/删除）
- 📝 显示删除理由和申请人类型
- 🔓 任何人都可以点击"解冻"按钮取消删除

### 3. 解冻操作

在24小时内，任何用户都可以：

- 点击"解冻"按钮
- 确认后立即恢复正常状态
- 删除计划被取消

### 4. 自动删除

如果24小时内无人解冻：

- 系统自动删除凭证文件
- 自动备份到 `creds/backup/` 目录
- 备份文件格式：`creds_XXX_YYYYMMDDHHMMSS.toml.bak`
- 清除冻结状态记录

## 技术实现

### 后端

1. **数据模型**：
   - `CredFileActionRequest` 添加 `is_owner` 和 `delete_reason` 字段
   - `freeze_status` 存储在 `creds_state.toml` 中

2. **API 端点**：
   - `POST /creds/action` - action: "freeze" 冻结凭证
   - `POST /creds/action` - action: "unfreeze" 解冻凭证

3. **后台任务**：
   - 每小时检查一次冻结凭证
   - 自动删除超过24小时的冻结凭证

### 前端

1. **删除流程**：
   - `deleteCred()` 函数实现多步确认
   - 显示邮箱确认对话框
   - 非所有者需输入理由

2. **解冻功能**：
   - `unfreezeCred()` 函数实现解冻
   - 一键恢复正常状态

3. **UI 显示**：
   - 冻结卡片特殊样式（红色边框）
   - 显示剩余时间倒计时
   - 显示删除理由和申请人类型

## 数据结构

### freeze_status 字段

```json
{
  "frozen": true,
  "freeze_time": 1732612345,
  "is_owner": false,
  "delete_reason": "此账号已不再使用，申请删除",
  "auto_delete_time": 1732698745
}
```

## 安全特性

1. ✅ 防止误删：24小时冷静期
2. ✅ 社区监督：任何人都可以解冻
3. ✅ 理由追溯：非所有者必须说明理由
4. ✅ 自动备份：删除前自动备份
5. ✅ 状态可见：冻结状态清晰显示

## 使用场景

### 场景1：账号所有者删除

1. 用户点击删除
2. 确认是自己的账号
3. 进入24小时冻结期
4. 如果反悔，可以自己解冻
5. 24小时后自动删除

### 场景2：其他用户申请删除

1. 用户点击删除
2. 选择"不是我的账号"
3. 输入删除理由（至少10字）
4. 进入24小时冻结期
5. 账号所有者或其他用户可以解冻
6. 24小时后自动删除

### 场景3：恶意删除被阻止

1. 恶意用户申请删除
2. 账号所有者发现后立即解冻
3. 删除计划被取消
4. 凭证恢复正常使用

## 注意事项

1. 冻结期间凭证不可用
2. 解冻操作无需密码
3. 删除理由会公开显示
4. 备份文件需要手动管理
5. 系统每小时检查一次，实际删除时间可能略有延迟
